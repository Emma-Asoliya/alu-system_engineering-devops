#!/usr/bin/env bash
# Update and install Nginx
apt-get -y update
apt-get install -y nginx

# Set ownership temporarily for editing
sudo chown -R "$USER":"$USER" /var/www/html
sudo chown -R "$USER":"$USER" /etc/nginx/sites-available/default

# Overwrite default Nginx page and 404 page
echo "Holberton School for the win!" > /var/www/html/index.html
echo "Ceci n'est pas une page" > /var/www/html/404.html

# Write new Nginx configuration
cat > /etc/nginx/sites-available/default <<EOF
server {
    listen 80 default_server;
    listen [::]:80 default_server;

    root /var/www/html;
    index index.html index.htm 404.html index.nginx-debian.html;

    server_name _;

    add_header X-Served-By \$hostname;

    location /redirect_me {
        return 301 https://www.youtube.com/watch?v=-VGIt10m9VQ;
    }

    location /xyz {
        return 404;
    }

    error_page 404 /404.html;
}
EOF

# Restore root ownership after edits
sudo chown -R root:root /var/www/html
sudo chown -R root:root /etc/nginx/sites-available/default

# Test Nginx configuration before restart
nginx -t

# Restart Nginx service
if [ $? -eq 0 ]; then
    sudo service nginx restart
else
    echo "Nginx configuration test failed."
fi
