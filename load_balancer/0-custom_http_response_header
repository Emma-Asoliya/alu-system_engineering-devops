#!/bin/bash

# Ensure the script runs as root
if [ "$(id -u)" -ne 0 ]; then
  echo "Please run this script as root or using sudo."
  exit 1
fi

# Update package list and install Nginx if not installed
echo "Updating package list and installing Nginx..."
apt update -y
apt install nginx -y

# Fetch the hostname of the machine
HOSTNAME=$(hostname)

# Configure Nginx to include the custom X-Served-By header
echo "Configuring Nginx to include custom X-Served-By header..."
cat > /etc/nginx/sites-available/default <<EOF
server {
    listen 80 default_server;
    listen [::]:80 default_server;

    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;

    server_name _;

    location / {
        try_files \$uri \$uri/ =404;
        add_header X-Served-By "$HOSTNAME";  # Custom header with hostname
    }
}
EOF

# Test the Nginx configuration for syntax errors
echo "Testing Nginx configuration..."
nginx -t

# Restart Nginx to apply changes
echo "Restarting Nginx..."
systemctl restart nginx

echo "Configuration complete! Nginx is serving with the custom header."
